---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - .env.local
  - .env.example
  - drizzle.config.ts
  - src/db/index.ts
  - src/db/schema/domain.ts
  - src/db/schema/index.ts
autonomous: true
requirements:
  - AUTH-01
  - AUTH-02
  - AUTH-03
  - AUTH-05

must_haves:
  truths:
    - "Next.js 15.5 app runs at localhost:3000 with no build errors"
    - "All required packages are installed and importable"
    - "DATABASE_URL env var is wired and Drizzle client connects to Neon"
    - "Domain schema tables (properties, units, tenant_units) are defined with correct types"
    - "smsOptIn and smsOptInAt fields are present in the schema to prevent Phase 5 migration"
  artifacts:
    - path: "package.json"
      provides: "All Phase 1 dependencies installed"
      contains: "better-auth"
    - path: ".env.example"
      provides: "Required env var documentation"
      contains: "DATABASE_URL"
    - path: "drizzle.config.ts"
      provides: "Drizzle-kit configuration pointing to src/db/schema"
    - path: "src/db/index.ts"
      provides: "Drizzle client using Neon HTTP driver"
      exports: ["db"]
    - path: "src/db/schema/domain.ts"
      provides: "Domain tables: properties, units, tenant_units"
      contains: "tenantUnits"
    - path: "src/db/schema/index.ts"
      provides: "Barrel export of all schema tables"
  key_links:
    - from: "src/db/index.ts"
      to: "DATABASE_URL"
      via: "process.env.DATABASE_URL"
      pattern: "DATABASE_URL"
    - from: "src/db/schema/domain.ts"
      to: "user.id"
      via: "text('user_id') — NOT uuid — matching Better Auth generated type"
      pattern: "text.*user_id"
---

<objective>
Scaffold the Next.js 15.5 application, install all Phase 1 dependencies, configure the Drizzle ORM client against Neon PostgreSQL, and define the complete domain schema. This plan creates the structural foundation that every subsequent plan in this phase builds on.

Purpose: Every other plan depends on the app scaffold and database layer existing. Getting this right — particularly the user_id type in domain tables (text, not uuid) — prevents expensive schema rewrites later.

Output: A runnable Next.js app with all packages installed, a working Drizzle + Neon connection, and a complete domain schema covering properties, units, and tenant_units. No auth yet — that is Plan 02.
</objective>

<execution_context>
@/Users/odesantos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/odesantos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js app and install all Phase 1 packages</name>
  <files>
    package.json
    tsconfig.json
    next.config.ts
    .env.local
    .env.example
    .gitignore
    src/app/layout.tsx
    src/app/page.tsx
    src/app/globals.css
  </files>
  <action>
Run the following commands in sequence from /Users/odesantos/Documents/rentalmgmt/:

IMPORTANT: The directory already contains a README.md. Do NOT run create-next-app — instead, initialize Next.js manually by installing packages and creating the required files by hand.

Step 1 — Initialize package.json and install core framework:
```bash
npm init -y
npm install next@15.5 react@19 react-dom@19
npm install -D typescript @types/node @types/react @types/react-dom
```

Step 2 — Install auth:
```bash
npm install better-auth
npm install -D @better-auth/cli
```

Step 3 — Install database:
```bash
npm install drizzle-orm @neondatabase/serverless dotenv
npm install -D drizzle-kit tsx
```

Step 4 — Install UI:
```bash
npx shadcn@latest init
```
When prompted: select `new-york` style, choose Tailwind v4 (CSS-only config). Do NOT install tailwindcss-animate — shadcn/ui Tailwind v4 uses tw-animate-css instead. Accept all other defaults.

Step 5 — Install forms, validation, email, and utilities:
```bash
npm install zod react-hook-form @hookform/resolvers
npm install resend @react-email/components
npm install sonner lucide-react
```

Create .env.local with these required vars (leave placeholders for the developer to fill):
```
DATABASE_URL=postgres://...  # Neon connection string from Neon dashboard
BETTER_AUTH_SECRET=          # Generate: openssl rand -base64 32
BETTER_AUTH_URL=http://localhost:3000
RESEND_API_KEY=              # From Resend dashboard
ADMIN_EMAIL=                 # First admin user email (for seed script)
ADMIN_PASSWORD=              # First admin user password (for seed script)
```

Create .env.example with the same keys but no values (safe to commit):
```
DATABASE_URL=
BETTER_AUTH_SECRET=
BETTER_AUTH_URL=http://localhost:3000
RESEND_API_KEY=
ADMIN_EMAIL=
ADMIN_PASSWORD=
```

Add .env.local to .gitignore if not already present.

Create tsconfig.json with strict mode and path alias:
```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [{ "name": "next" }],
    "paths": { "@/*": ["./src/*"] }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

Create next.config.ts:
```typescript
import type { NextConfig } from "next"

const nextConfig: NextConfig = {}

export default nextConfig
```

Create src/app/globals.css with Tailwind v4 CSS-only import (no tailwind.config.ts needed):
```css
@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));
```

Create src/app/layout.tsx:
```typescript
import type { Metadata } from "next"
import "./globals.css"

export const metadata: Metadata = {
  title: "RentalMgmt",
  description: "Tenant rent payment portal",
}

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}
```

Create src/app/page.tsx as a simple redirect placeholder:
```typescript
import { redirect } from "next/navigation"

export default function Home() {
  redirect("/auth/login")
}
```

Add scripts to package.json:
```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint --config eslint.config.mjs",
    "db:generate": "drizzle-kit generate",
    "db:migrate": "drizzle-kit migrate",
    "db:push": "drizzle-kit push",
    "db:studio": "drizzle-kit studio"
  }
}
```
  </action>
  <verify>
    <automated>cd /Users/odesantos/Documents/rentalmgmt && npm run build 2>&1 | tail -5</automated>
  </verify>
  <done>
    npm run build completes without TypeScript errors. node_modules exists with better-auth, drizzle-orm, @neondatabase/serverless, next, zod, react-hook-form, resend, sonner, lucide-react all present. .env.local exists with placeholder values. .env.example is committed-safe version.
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure Drizzle + Neon client and define domain schema</name>
  <files>
    drizzle.config.ts
    src/db/index.ts
    src/db/schema/domain.ts
    src/db/schema/index.ts
  </files>
  <action>
Create drizzle.config.ts at project root:
```typescript
import "dotenv/config"
import { defineConfig } from "drizzle-kit"

export default defineConfig({
  out: "./drizzle",
  schema: "./src/db/schema",   // points to schema directory — picks up all files
  dialect: "postgresql",
  dbCredentials: {
    url: process.env.DATABASE_URL!,
  },
})
```

Create src/db/index.ts — Drizzle HTTP client using Neon serverless driver:
```typescript
import { neon } from "@neondatabase/serverless"
import { drizzle } from "drizzle-orm/neon-http"
import * as schema from "./schema"

const sql = neon(process.env.DATABASE_URL!)
export const db = drizzle({ client: sql, schema })
export type DB = typeof db
```

Create src/db/schema/domain.ts — domain tables. CRITICAL: userId foreign keys must use text(), NOT uuid(), because Better Auth generates user.id as text:
```typescript
import {
  pgTable,
  text,
  integer,
  boolean,
  timestamp,
  uuid,
} from "drizzle-orm/pg-core"

export const properties = pgTable("properties", {
  id: uuid("id").primaryKey().defaultRandom(),
  name: text("name").notNull(),
  address: text("address").notNull(),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})

export const units = pgTable("units", {
  id: uuid("id").primaryKey().defaultRandom(),
  propertyId: uuid("property_id")
    .references(() => properties.id, { onDelete: "cascade" })
    .notNull(),
  unitNumber: text("unit_number").notNull(),
  rentAmountCents: integer("rent_amount_cents"),  // nullable until Phase 3 configures it
  rentDueDay: integer("rent_due_day"),             // day of month 1-28, nullable until Phase 3
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
})

// Links a user (tenant) to a unit — supports historical tenancy records
export const tenantUnits = pgTable("tenant_units", {
  id: uuid("id").primaryKey().defaultRandom(),
  userId: text("user_id").notNull(),              // references Better Auth user.id (text, NOT uuid)
  unitId: uuid("unit_id")
    .references(() => units.id, { onDelete: "cascade" })
    .notNull(),
  startDate: timestamp("start_date").notNull(),
  endDate: timestamp("end_date"),                 // null = active/current tenancy
  isActive: boolean("is_active").default(true).notNull(),
  createdAt: timestamp("created_at").defaultNow().notNull(),
})
```

Note: The smsOptIn and smsOptInAt fields for notification preferences are NOT in the domain schema directly — they are added to the Better Auth user table via additionalFields in src/lib/auth.ts (Plan 02). This is the correct approach per the RESEARCH.md pattern.

Create src/db/schema/index.ts — barrel export. The auth schema file (auth.ts) will be added here in Plan 02 after @better-auth/cli generates it:
```typescript
// Better Auth generated tables — added in Plan 02 after CLI generation
// export * from "./auth"

export * from "./domain"
```

The commented-out auth export will be uncommented in Plan 02. Leave it as a comment now so this file is valid TypeScript and the domain tables are immediately importable.
  </action>
  <verify>
    <automated>cd /Users/odesantos/Documents/rentalmgmt && npx tsx -e "import('./src/db/index.ts').then(m => console.log('DB client loaded:', typeof m.db))" 2>&1</automated>
  </verify>
  <done>
    drizzle.config.ts exists at project root pointing to ./src/db/schema. src/db/index.ts exports db using neon() + drizzle() with schema passed. src/db/schema/domain.ts defines properties, units, and tenantUnits tables. tenantUnits.userId is text(), not uuid(). src/db/schema/index.ts barrel-exports domain tables (auth export commented, to be added in Plan 02).
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run build` passes with no TypeScript errors
2. All required packages present in node_modules (check: `ls node_modules | grep -E "better-auth|drizzle|@neondatabase|resend|sonner"`)
3. src/db/schema/domain.ts exists and tenantUnits.userId is `text()` not `uuid()`
4. drizzle.config.ts points to ./src/db/schema (directory, not a single file)
5. .env.local exists (not committed), .env.example exists (committed)
</verification>

<success_criteria>
- Next.js 15.5 app builds cleanly
- All Phase 1 packages installed (better-auth, drizzle-orm, @neondatabase/serverless, zod, react-hook-form, resend, sonner, lucide-react)
- Drizzle client (src/db/index.ts) imports and exports `db` without errors
- Domain schema defines properties, units, and tenantUnits with correct column types
- .env.local present with all required var keys (values are developer-filled placeholders)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
