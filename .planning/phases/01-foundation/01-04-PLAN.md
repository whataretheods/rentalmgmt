---
phase: 01-foundation
plan: 04
type: execute
wave: 3
depends_on:
  - 01-02
files_modified:
  - src/app/auth/login/page.tsx
  - src/app/auth/register/page.tsx
  - src/app/auth/forgot-password/page.tsx
  - src/app/auth/reset-password/page.tsx
  - src/components/auth/LoginForm.tsx
  - src/components/auth/RegisterForm.tsx
  - src/components/auth/ForgotPasswordForm.tsx
  - src/components/auth/ResetPasswordForm.tsx
autonomous: true
requirements:
  - AUTH-01
  - AUTH-03

must_haves:
  truths:
    - "User can navigate to /auth/login and submit email + password to sign in"
    - "User can navigate to /auth/register and create a new account with email, password, and name"
    - "User sees a toast error on invalid credentials or duplicate email"
    - "User can submit /auth/forgot-password with their email to request a reset link"
    - "User can submit /auth/reset-password?token=... with a new password to complete reset"
    - "After successful login, user is redirected to /tenant/dashboard"
    - "After successful registration, user is redirected to /tenant/dashboard"
  artifacts:
    - path: "src/app/auth/login/page.tsx"
      provides: "Login page wrapping LoginForm"
    - path: "src/app/auth/register/page.tsx"
      provides: "Registration page wrapping RegisterForm"
    - path: "src/app/auth/forgot-password/page.tsx"
      provides: "Forgot password request page"
    - path: "src/app/auth/reset-password/page.tsx"
      provides: "Password reset completion page — reads token from URL search params"
    - path: "src/components/auth/LoginForm.tsx"
      provides: "Client Component — email/password form, submits via authClient.signIn.email"
    - path: "src/components/auth/RegisterForm.tsx"
      provides: "Client Component — name/email/password form, submits via authClient.signUp.email"
    - path: "src/components/auth/ForgotPasswordForm.tsx"
      provides: "Client Component — email form, calls authClient.forgetPassword"
    - path: "src/components/auth/ResetPasswordForm.tsx"
      provides: "Client Component — new password form, calls authClient.resetPassword with token from URL"
  key_links:
    - from: "src/components/auth/LoginForm.tsx"
      to: "src/lib/auth-client.ts"
      via: "authClient.signIn.email({ email, password })"
      pattern: "signIn.email"
    - from: "src/components/auth/RegisterForm.tsx"
      to: "src/lib/auth-client.ts"
      via: "authClient.signUp.email({ email, password, name })"
      pattern: "signUp.email"
    - from: "src/components/auth/ForgotPasswordForm.tsx"
      to: "src/lib/auth-client.ts"
      via: "authClient.forgetPassword({ email, redirectTo: '/auth/reset-password' })"
      pattern: "forgetPassword"
    - from: "src/components/auth/ResetPasswordForm.tsx"
      to: "src/lib/auth-client.ts"
      via: "authClient.resetPassword({ newPassword, token })"
      pattern: "resetPassword"
---

<objective>
Build all four auth UI pages — login, register, forgot-password, and reset-password — using shadcn/ui components, react-hook-form with Zod validation, and the Better Auth browser client. These pages wire directly to Better Auth's API through authClient, no custom Server Actions needed for auth flows.

Purpose: AUTH-01 (account creation) needs the registration form. AUTH-03 (password reset) needs both forgot-password and reset-password pages. These pages can be built in parallel with Plan 03 (middleware) since they only depend on Plan 02's auth-client.ts.

Output: Four auth pages and four Client Component forms with full validation, error handling via sonner toasts, and correct post-auth redirects.
</objective>

<execution_context>
@/Users/odesantos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/odesantos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-02-SUMMARY.md

<interfaces>
<!-- Key exports from Plan 02 that this plan uses -->

From src/lib/auth-client.ts:
```typescript
export const authClient: BetterAuthClient

// Sign in with email/password
await authClient.signIn.email({
  email: string,
  password: string,
  callbackURL: string,  // redirect after success
})
// Returns { data, error } — error.message has user-facing string

// Register new account
await authClient.signUp.email({
  email: string,
  password: string,
  name: string,
  callbackURL: string,
})

// Request password reset email
await authClient.forgetPassword({
  email: string,
  redirectTo: string,  // URL where token is appended as ?token=...
})

// Complete password reset with token from URL
await authClient.resetPassword({
  newPassword: string,
  token: string,        // from URL search params
})
```

shadcn/ui components available (installed in Plan 01 via npx shadcn@latest init):
- Button, Input, Label, Form (from react-hook-form integration), Card
- Sonner (toast) — import { toast } from "sonner"
- Install individual components as needed: npx shadcn@latest add button input label card
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build login and registration forms + pages</name>
  <files>
    src/components/auth/LoginForm.tsx
    src/components/auth/RegisterForm.tsx
    src/app/auth/login/page.tsx
    src/app/auth/register/page.tsx
  </files>
  <action>
First, add required shadcn/ui components if not already added by init:
```bash
cd /Users/odesantos/Documents/rentalmgmt && npx shadcn@latest add button input label card
```

Create src/components/auth/LoginForm.tsx — Client Component:
```typescript
"use client"

import { useState } from "react"
import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import { z } from "zod"
import { useRouter, useSearchParams } from "next/navigation"
import { toast } from "sonner"
import { authClient } from "@/lib/auth-client"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"

const loginSchema = z.object({
  email: z.string().email("Enter a valid email"),
  password: z.string().min(1, "Password is required"),
})

type LoginValues = z.infer<typeof loginSchema>

export function LoginForm() {
  const router = useRouter()
  const searchParams = useSearchParams()
  const callbackUrl = searchParams.get("callbackUrl") ?? "/tenant/dashboard"
  const [isLoading, setIsLoading] = useState(false)

  const form = useForm<LoginValues>({
    resolver: zodResolver(loginSchema),
    defaultValues: { email: "", password: "" },
  })

  async function onSubmit(values: LoginValues) {
    setIsLoading(true)
    const { error } = await authClient.signIn.email({
      email: values.email,
      password: values.password,
      callbackURL: callbackUrl,
    })
    setIsLoading(false)

    if (error) {
      toast.error(error.message ?? "Sign in failed. Check your credentials.")
      return
    }

    router.push(callbackUrl)
    router.refresh()
  }

  return (
    <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
      <div className="space-y-2">
        <Label htmlFor="email">Email</Label>
        <Input
          id="email"
          type="email"
          placeholder="you@example.com"
          {...form.register("email")}
        />
        {form.formState.errors.email && (
          <p className="text-sm text-red-600">{form.formState.errors.email.message}</p>
        )}
      </div>

      <div className="space-y-2">
        <Label htmlFor="password">Password</Label>
        <Input
          id="password"
          type="password"
          placeholder="••••••••"
          {...form.register("password")}
        />
        {form.formState.errors.password && (
          <p className="text-sm text-red-600">{form.formState.errors.password.message}</p>
        )}
      </div>

      <Button type="submit" className="w-full" disabled={isLoading}>
        {isLoading ? "Signing in..." : "Sign in"}
      </Button>
    </form>
  )
}
```

Create src/components/auth/RegisterForm.tsx — Client Component:
```typescript
"use client"

import { useState } from "react"
import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import { z } from "zod"
import { useRouter } from "next/navigation"
import { toast } from "sonner"
import { authClient } from "@/lib/auth-client"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"

const registerSchema = z.object({
  name: z.string().min(2, "Name must be at least 2 characters"),
  email: z.string().email("Enter a valid email"),
  password: z.string().min(8, "Password must be at least 8 characters"),
  confirmPassword: z.string(),
}).refine((data) => data.password === data.confirmPassword, {
  message: "Passwords do not match",
  path: ["confirmPassword"],
})

type RegisterValues = z.infer<typeof registerSchema>

export function RegisterForm() {
  const router = useRouter()
  const [isLoading, setIsLoading] = useState(false)

  const form = useForm<RegisterValues>({
    resolver: zodResolver(registerSchema),
    defaultValues: { name: "", email: "", password: "", confirmPassword: "" },
  })

  async function onSubmit(values: RegisterValues) {
    setIsLoading(true)
    const { error } = await authClient.signUp.email({
      email: values.email,
      password: values.password,
      name: values.name,
      callbackURL: "/tenant/dashboard",
    })
    setIsLoading(false)

    if (error) {
      toast.error(error.message ?? "Registration failed. Try a different email.")
      return
    }

    router.push("/tenant/dashboard")
    router.refresh()
  }

  return (
    <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
      <div className="space-y-2">
        <Label htmlFor="name">Full name</Label>
        <Input id="name" placeholder="Jane Smith" {...form.register("name")} />
        {form.formState.errors.name && (
          <p className="text-sm text-red-600">{form.formState.errors.name.message}</p>
        )}
      </div>

      <div className="space-y-2">
        <Label htmlFor="email">Email</Label>
        <Input id="email" type="email" placeholder="you@example.com" {...form.register("email")} />
        {form.formState.errors.email && (
          <p className="text-sm text-red-600">{form.formState.errors.email.message}</p>
        )}
      </div>

      <div className="space-y-2">
        <Label htmlFor="password">Password</Label>
        <Input id="password" type="password" placeholder="••••••••" {...form.register("password")} />
        {form.formState.errors.password && (
          <p className="text-sm text-red-600">{form.formState.errors.password.message}</p>
        )}
      </div>

      <div className="space-y-2">
        <Label htmlFor="confirmPassword">Confirm password</Label>
        <Input id="confirmPassword" type="password" placeholder="••••••••" {...form.register("confirmPassword")} />
        {form.formState.errors.confirmPassword && (
          <p className="text-sm text-red-600">{form.formState.errors.confirmPassword.message}</p>
        )}
      </div>

      <Button type="submit" className="w-full" disabled={isLoading}>
        {isLoading ? "Creating account..." : "Create account"}
      </Button>
    </form>
  )
}
```

Create src/app/auth/login/page.tsx:
```typescript
import { Suspense } from "react"
import Link from "next/link"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { LoginForm } from "@/components/auth/LoginForm"

export default function LoginPage() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 px-4">
      <Card className="w-full max-w-sm">
        <CardHeader>
          <CardTitle>Sign in</CardTitle>
          <CardDescription>Enter your email and password to access your account</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <Suspense>
            <LoginForm />
          </Suspense>
          <div className="text-center text-sm">
            <Link href="/auth/forgot-password" className="text-blue-600 hover:underline">
              Forgot your password?
            </Link>
          </div>
          <div className="text-center text-sm text-gray-600">
            Don&apos;t have an account?{" "}
            <Link href="/auth/register" className="text-blue-600 hover:underline">
              Create one
            </Link>
          </div>
        </CardContent>
      </Card>
    </div>
  )
}
```

Create src/app/auth/register/page.tsx:
```typescript
import Link from "next/link"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { RegisterForm } from "@/components/auth/RegisterForm"

export default function RegisterPage() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 px-4">
      <Card className="w-full max-w-sm">
        <CardHeader>
          <CardTitle>Create account</CardTitle>
          <CardDescription>Enter your details to create your tenant account</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <RegisterForm />
          <div className="text-center text-sm text-gray-600">
            Already have an account?{" "}
            <Link href="/auth/login" className="text-blue-600 hover:underline">
              Sign in
            </Link>
          </div>
        </CardContent>
      </Card>
    </div>
  )
}
```
  </action>
  <verify>
    <automated>cd /Users/odesantos/Documents/rentalmgmt && npm run build 2>&1 | grep -E "error TS|compiled successfully" | head -10</automated>
  </verify>
  <done>
    LoginForm.tsx and RegisterForm.tsx exist with "use client" directive. Both use react-hook-form + zod validation. Both call authClient.signIn.email / authClient.signUp.email respectively. Both use sonner toast for errors. Both login/register page.tsx files wrap the forms in Card components. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build forgot-password and reset-password forms + pages</name>
  <files>
    src/components/auth/ForgotPasswordForm.tsx
    src/components/auth/ResetPasswordForm.tsx
    src/app/auth/forgot-password/page.tsx
    src/app/auth/reset-password/page.tsx
  </files>
  <action>
Create src/components/auth/ForgotPasswordForm.tsx — Client Component:
```typescript
"use client"

import { useState } from "react"
import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import { z } from "zod"
import { toast } from "sonner"
import { authClient } from "@/lib/auth-client"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"

const forgotSchema = z.object({
  email: z.string().email("Enter a valid email"),
})

type ForgotValues = z.infer<typeof forgotSchema>

export function ForgotPasswordForm() {
  const [isLoading, setIsLoading] = useState(false)
  const [sent, setSent] = useState(false)

  const form = useForm<ForgotValues>({
    resolver: zodResolver(forgotSchema),
    defaultValues: { email: "" },
  })

  async function onSubmit(values: ForgotValues) {
    setIsLoading(true)
    await authClient.forgetPassword({
      email: values.email,
      redirectTo: "/auth/reset-password",  // Better Auth appends ?token=... here
    })
    setIsLoading(false)
    // Always show success — do not leak whether email exists (security best practice)
    setSent(true)
  }

  if (sent) {
    return (
      <p className="text-sm text-gray-600 text-center">
        If that email is registered, you will receive a password reset link shortly.
      </p>
    )
  }

  return (
    <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
      <div className="space-y-2">
        <Label htmlFor="email">Email</Label>
        <Input
          id="email"
          type="email"
          placeholder="you@example.com"
          {...form.register("email")}
        />
        {form.formState.errors.email && (
          <p className="text-sm text-red-600">{form.formState.errors.email.message}</p>
        )}
      </div>

      <Button type="submit" className="w-full" disabled={isLoading}>
        {isLoading ? "Sending..." : "Send reset link"}
      </Button>
    </form>
  )
}
```

Create src/components/auth/ResetPasswordForm.tsx — Client Component:
```typescript
"use client"

import { useState } from "react"
import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import { z } from "zod"
import { useRouter, useSearchParams } from "next/navigation"
import { toast } from "sonner"
import { authClient } from "@/lib/auth-client"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"

const resetSchema = z.object({
  newPassword: z.string().min(8, "Password must be at least 8 characters"),
  confirmPassword: z.string(),
}).refine((data) => data.newPassword === data.confirmPassword, {
  message: "Passwords do not match",
  path: ["confirmPassword"],
})

type ResetValues = z.infer<typeof resetSchema>

export function ResetPasswordForm() {
  const router = useRouter()
  const searchParams = useSearchParams()
  const token = searchParams.get("token")
  const [isLoading, setIsLoading] = useState(false)

  const form = useForm<ResetValues>({
    resolver: zodResolver(resetSchema),
    defaultValues: { newPassword: "", confirmPassword: "" },
  })

  if (!token) {
    return (
      <p className="text-sm text-red-600 text-center">
        Invalid or missing reset token. Please request a new password reset link.
      </p>
    )
  }

  async function onSubmit(values: ResetValues) {
    if (!token) return
    setIsLoading(true)
    const { error } = await authClient.resetPassword({
      newPassword: values.newPassword,
      token,
    })
    setIsLoading(false)

    if (error) {
      toast.error(error.message ?? "Password reset failed. The link may have expired.")
      return
    }

    toast.success("Password reset successfully. You can now sign in.")
    router.push("/auth/login")
  }

  return (
    <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
      <div className="space-y-2">
        <Label htmlFor="newPassword">New password</Label>
        <Input
          id="newPassword"
          type="password"
          placeholder="••••••••"
          {...form.register("newPassword")}
        />
        {form.formState.errors.newPassword && (
          <p className="text-sm text-red-600">{form.formState.errors.newPassword.message}</p>
        )}
      </div>

      <div className="space-y-2">
        <Label htmlFor="confirmPassword">Confirm new password</Label>
        <Input
          id="confirmPassword"
          type="password"
          placeholder="••••••••"
          {...form.register("confirmPassword")}
        />
        {form.formState.errors.confirmPassword && (
          <p className="text-sm text-red-600">{form.formState.errors.confirmPassword.message}</p>
        )}
      </div>

      <Button type="submit" className="w-full" disabled={isLoading}>
        {isLoading ? "Resetting..." : "Reset password"}
      </Button>
    </form>
  )
}
```

Create src/app/auth/forgot-password/page.tsx:
```typescript
import Link from "next/link"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { ForgotPasswordForm } from "@/components/auth/ForgotPasswordForm"

export default function ForgotPasswordPage() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 px-4">
      <Card className="w-full max-w-sm">
        <CardHeader>
          <CardTitle>Reset password</CardTitle>
          <CardDescription>Enter your email and we will send you a reset link</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <ForgotPasswordForm />
          <div className="text-center text-sm">
            <Link href="/auth/login" className="text-blue-600 hover:underline">
              Back to sign in
            </Link>
          </div>
        </CardContent>
      </Card>
    </div>
  )
}
```

Create src/app/auth/reset-password/page.tsx — MUST wrap ResetPasswordForm in Suspense because it uses useSearchParams():
```typescript
import { Suspense } from "react"
import Link from "next/link"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { ResetPasswordForm } from "@/components/auth/ResetPasswordForm"

export default function ResetPasswordPage() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 px-4">
      <Card className="w-full max-w-sm">
        <CardHeader>
          <CardTitle>Set new password</CardTitle>
          <CardDescription>Enter your new password below</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <Suspense fallback={<p className="text-sm text-gray-500">Loading...</p>}>
            <ResetPasswordForm />
          </Suspense>
          <div className="text-center text-sm">
            <Link href="/auth/login" className="text-blue-600 hover:underline">
              Back to sign in
            </Link>
          </div>
        </CardContent>
      </Card>
    </div>
  )
}
```

IMPORTANT: Both ResetPasswordForm and LoginForm use useSearchParams() which requires a Suspense boundary in the parent page. Failure to wrap in Suspense causes a build error in Next.js 15.
  </action>
  <verify>
    <automated>cd /Users/odesantos/Documents/rentalmgmt && npm run build 2>&1 | grep -E "error TS|compiled successfully|Error" | head -15</automated>
  </verify>
  <done>
    ForgotPasswordForm.tsx shows "success" message without leaking email existence. ResetPasswordForm.tsx reads token from useSearchParams(), shows error if token missing. Both forgot-password and reset-password page.tsx files wrap forms in appropriate Suspense boundaries. Build passes with no TypeScript errors.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run build` passes — no TypeScript errors (useSearchParams in Suspense is the common failure point)
2. All 8 files exist: 4 form components in src/components/auth/, 4 pages in src/app/auth/
3. `grep "use client" src/components/auth/LoginForm.tsx` — present
4. `grep "Suspense" src/app/auth/login/page.tsx` — LoginForm wrapped in Suspense (uses useSearchParams)
5. `grep "Suspense" src/app/auth/reset-password/page.tsx` — ResetPasswordForm wrapped in Suspense
6. `grep "forgetPassword" src/components/auth/ForgotPasswordForm.tsx` — uses correct Better Auth method name
</verification>

<success_criteria>
- All four auth pages are accessible routes: /auth/login, /auth/register, /auth/forgot-password, /auth/reset-password
- Login form calls authClient.signIn.email, shows sonner toast on error
- Register form calls authClient.signUp.email with name field, 8-char minimum password, confirm password match validation
- Forgot password form calls authClient.forgetPassword (note: forgetPassword, not forgotPassword)
- Reset password form reads token from URL params, calls authClient.resetPassword
- All useSearchParams() usages wrapped in Suspense boundaries
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-04-SUMMARY.md`
</output>
