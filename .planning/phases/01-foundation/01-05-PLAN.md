---
phase: 01-foundation
plan: 05
type: execute
wave: 4
depends_on:
  - 01-03
  - 01-04
files_modified:
  - src/app/(admin)/users/page.tsx
  - src/components/admin/UserTable.tsx
  - scripts/seed-admin.ts
  - scripts/seed-property.ts
autonomous: true
requirements:
  - AUTH-05

must_haves:
  truths:
    - "An admin user can be created via seed script and log in to the admin portal"
    - "Admin portal shows a list of registered users with their email, name, and role"
    - "The property and initial units exist in the database after running the seed script"
    - "Admin portal is inaccessible to non-admin users (enforced by layout from Plan 03)"
  artifacts:
    - path: "src/app/(admin)/users/page.tsx"
      provides: "Admin user list page — fetches all users from Better Auth via server-side query"
    - path: "src/components/admin/UserTable.tsx"
      provides: "Server Component — renders users in a table with email, name, role, created date"
    - path: "scripts/seed-admin.ts"
      provides: "Script to create first admin user via Better Auth's server-side API"
    - path: "scripts/seed-property.ts"
      provides: "Script to seed the single property and 5 units into the database"
  key_links:
    - from: "src/app/(admin)/users/page.tsx"
      to: "src/db"
      via: "db.query.user.findMany() — direct Drizzle query against Better Auth user table"
      pattern: "db.query"
    - from: "scripts/seed-admin.ts"
      to: "src/lib/auth.ts"
      via: "auth.api.createUser({ body: { role: 'admin' } })"
      pattern: "createUser"
    - from: "scripts/seed-property.ts"
      to: "src/db"
      via: "db.insert(properties).values(...)"
      pattern: "db.insert"
---

<objective>
Build the barebones admin interface (user list page) and create the seeding scripts needed to bootstrap the first admin user and the single property + units. Without the seed scripts, the admin portal cannot be tested — there is no way to create an admin user through the UI (by design).

Purpose: AUTH-05 requires multiple admin users can log in. The admin portal exists (layouts from Plan 03), but needs content and a way to create admin users. This plan delivers the minimal admin UI and the bootstrap mechanism.

Output: Admin users page, UserTable component, seed-admin.ts script, seed-property.ts script.
</objective>

<execution_context>
@/Users/odesantos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/odesantos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-03-SUMMARY.md
@.planning/phases/01-foundation/01-04-SUMMARY.md

<interfaces>
<!-- Key exports that this plan uses -->

From src/lib/auth.ts:
```typescript
export const auth: BetterAuth

// Server-side user creation (used in seed script):
await auth.api.createUser({
  body: {
    email: string,
    password: string,
    name: string,
    role: "admin",  // only settable server-side
  },
})
```

From src/db/index.ts:
```typescript
export const db: DrizzleDb
```

From src/db/schema (Better Auth generated user table has these columns):
```typescript
// user table — generated by @better-auth/cli
// columns include: id (text), email (text), name (text), role (text),
//                  emailVerified (boolean), createdAt (timestamp), updatedAt (timestamp)
//                  smsOptIn (boolean), smsOptInAt (text) — from additionalFields
```

From src/db/schema/domain.ts:
```typescript
export const properties: PgTable  // id, name, address, createdAt, updatedAt
export const units: PgTable       // id, propertyId, unitNumber, rentAmountCents, rentDueDay, ...
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build admin users page with UserTable component</name>
  <files>
    src/app/(admin)/users/page.tsx
    src/components/admin/UserTable.tsx
  </files>
  <action>
IMPORTANT: This is a Server Component — no "use client" needed. Data is fetched server-side using Drizzle directly. The admin layout (from Plan 03) already validates the session and role before this page renders, so no auth check needed here.

Create src/components/admin/UserTable.tsx — Server Component rendering user data:
```typescript
import { db } from "@/db"

// Better Auth's user table is in the schema — query it directly via Drizzle
// The table name in Drizzle schema is `user` (singular, as generated by Better Auth CLI)

interface UserTableProps {
  users: {
    id: string
    email: string
    name: string | null
    role: string | null
    createdAt: Date
  }[]
}

export function UserTable({ users }: UserTableProps) {
  return (
    <div className="rounded-md border">
      <table className="w-full text-sm">
        <thead>
          <tr className="border-b bg-gray-50">
            <th className="px-4 py-3 text-left font-medium text-gray-700">Name</th>
            <th className="px-4 py-3 text-left font-medium text-gray-700">Email</th>
            <th className="px-4 py-3 text-left font-medium text-gray-700">Role</th>
            <th className="px-4 py-3 text-left font-medium text-gray-700">Joined</th>
          </tr>
        </thead>
        <tbody>
          {users.length === 0 ? (
            <tr>
              <td colSpan={4} className="px-4 py-8 text-center text-gray-500">
                No users yet.
              </td>
            </tr>
          ) : (
            users.map((user) => (
              <tr key={user.id} className="border-b last:border-0">
                <td className="px-4 py-3 text-gray-900">{user.name ?? "—"}</td>
                <td className="px-4 py-3 text-gray-600">{user.email}</td>
                <td className="px-4 py-3">
                  <span
                    className={`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ${
                      user.role === "admin"
                        ? "bg-purple-100 text-purple-800"
                        : "bg-blue-100 text-blue-800"
                    }`}
                  >
                    {user.role ?? "user"}
                  </span>
                </td>
                <td className="px-4 py-3 text-gray-500">
                  {user.createdAt.toLocaleDateString()}
                </td>
              </tr>
            ))
          )}
        </tbody>
      </table>
    </div>
  )
}
```

Create src/app/(admin)/users/page.tsx — Server Component, fetches users via Drizzle:
```typescript
import { db } from "@/db"
import { user } from "@/db/schema"
import { desc } from "drizzle-orm"
import { UserTable } from "@/components/admin/UserTable"

export default async function AdminUsersPage() {
  // Query the Better Auth user table via Drizzle
  // Table is named `user` (singular) in the generated schema
  const users = await db
    .select({
      id: user.id,
      email: user.email,
      name: user.name,
      role: user.role,
      createdAt: user.createdAt,
    })
    .from(user)
    .orderBy(desc(user.createdAt))

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold text-gray-900">Users</h1>
        <p className="mt-1 text-sm text-gray-600">
          All registered accounts — {users.length} total
        </p>
      </div>
      <UserTable users={users} />
    </div>
  )
}
```

NOTE: The exact export name of the user table depends on what Better Auth CLI generates. The CLI typically generates a `user` const from `pgTable("user", ...)`. Check src/db/schema/auth.ts after it's generated in Plan 02 and use the exact export name. If it exports as `users` (plural), update the import accordingly.

Also update the admin dashboard (src/app/(admin)/dashboard/page.tsx) to add a navigation link to /admin/users. This is a minor enhancement, not a new file — just add a Link component pointing to /admin/users.
  </action>
  <verify>
    <automated>cd /Users/odesantos/Documents/rentalmgmt && npm run build 2>&1 | grep -E "error TS|compiled successfully" | head -10</automated>
  </verify>
  <done>
    src/app/(admin)/users/page.tsx is a Server Component that queries the user table via Drizzle and renders UserTable. UserTable shows columns: Name, Email, Role (color-coded badge), Joined date. Build passes. The admin dashboard has a link to /admin/users.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create admin seed script and property/unit seed script</name>
  <files>
    scripts/seed-admin.ts
    scripts/seed-property.ts
  </files>
  <action>
Create the scripts/ directory and both seed scripts. These run manually via `npx tsx scripts/...`.

Create scripts/seed-admin.ts:
```typescript
/**
 * Creates the first admin user.
 * Run once on initial setup: npx tsx scripts/seed-admin.ts
 *
 * Requires in .env.local:
 *   ADMIN_EMAIL=landlord@example.com
 *   ADMIN_PASSWORD=choose-a-strong-password
 *   DATABASE_URL=...
 *   BETTER_AUTH_SECRET=...
 */
import "dotenv/config"
import { auth } from "@/lib/auth"

async function seedAdmin() {
  const email = process.env.ADMIN_EMAIL
  const password = process.env.ADMIN_PASSWORD

  if (!email || !password) {
    console.error("Error: ADMIN_EMAIL and ADMIN_PASSWORD must be set in .env.local")
    process.exit(1)
  }

  try {
    const result = await auth.api.createUser({
      body: {
        email,
        password,
        name: "Admin",
        role: "admin",
      },
    })
    console.log("Admin user created successfully:")
    console.log("  ID:", result.user.id)
    console.log("  Email:", result.user.email)
    console.log("  Role:", result.user.role)
  } catch (error: unknown) {
    const message = error instanceof Error ? error.message : String(error)
    if (message.includes("already exists") || message.includes("duplicate") || message.includes("unique")) {
      console.log("Admin user already exists with email:", email)
    } else {
      console.error("Failed to create admin user:", message)
      process.exit(1)
    }
  }

  process.exit(0)
}

seedAdmin()
```

Create scripts/seed-property.ts — seeds the single property and 5 units:
```typescript
/**
 * Seeds the property and units into the database.
 * Run once on initial setup: npx tsx scripts/seed-property.ts
 *
 * Edit the PROPERTY and UNITS constants below to match the actual property.
 * Units are seeded with null rent amounts — configure these in Phase 3.
 *
 * Requires in .env.local:
 *   DATABASE_URL=...
 */
import "dotenv/config"
import { db } from "@/db"
import { properties, units } from "@/db/schema"

// Edit these to match the actual property
const PROPERTY = {
  name: "Rental Property",
  address: "123 Main Street, City, State 00000",
}

// Edit unit numbers to match actual unit designations
const UNIT_NUMBERS = ["1A", "1B", "2A", "2B", "3A"]

async function seedProperty() {
  try {
    // Insert property — ignore if already exists
    const [property] = await db
      .insert(properties)
      .values(PROPERTY)
      .onConflictDoNothing()
      .returning()

    if (!property) {
      console.log("Property already exists — skipping")
      process.exit(0)
    }

    console.log("Property created:", property.name, "(id:", property.id + ")")

    // Insert units
    const unitValues = UNIT_NUMBERS.map((unitNumber) => ({
      propertyId: property.id,
      unitNumber,
      // rentAmountCents and rentDueDay are null until Phase 3 admin configuration
    }))

    const insertedUnits = await db
      .insert(units)
      .values(unitValues)
      .onConflictDoNothing()
      .returning()

    console.log(`${insertedUnits.length} units created:`, insertedUnits.map((u) => u.unitNumber).join(", "))
  } catch (error: unknown) {
    const message = error instanceof Error ? error.message : String(error)
    console.error("Seed failed:", message)
    process.exit(1)
  }

  process.exit(0)
}

seedProperty()
```

Add seed scripts to package.json scripts section:
```json
{
  "scripts": {
    "seed:admin": "tsx scripts/seed-admin.ts",
    "seed:property": "tsx scripts/seed-property.ts"
  }
}
```

Add the scripts to the existing scripts section (don't replace, add alongside dev/build/lint/db:* scripts).

Update tsconfig.json to ensure scripts/ directory is covered — add "scripts/**/*.ts" to the `include` array if it's not using a wildcard. Most tsconfig setups already cover this with `"**/*.ts"`.
  </action>
  <verify>
    <automated>cd /Users/odesantos/Documents/rentalmgmt && npm run build 2>&1 | grep -E "error TS|compiled successfully" | head -10 && ls scripts/seed-admin.ts scripts/seed-property.ts</automated>
  </verify>
  <done>
    scripts/seed-admin.ts exists and uses auth.api.createUser with role: "admin". scripts/seed-property.ts exists and seeds property + UNIT_NUMBERS units using db.insert. Both scripts import dotenv/config and handle errors gracefully. package.json has seed:admin and seed:property scripts. Build passes.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run build` passes — no TypeScript errors
2. `ls scripts/seed-admin.ts scripts/seed-property.ts` — both exist
3. `grep "createUser" scripts/seed-admin.ts` — uses Better Auth server API
4. `grep "role.*admin" scripts/seed-admin.ts` — sets admin role
5. `ls src/app/\(admin\)/users/page.tsx` — admin users page exists
6. `grep "onConflictDoNothing" scripts/seed-property.ts` — idempotent seed

Run the seed scripts after DATABASE_URL and BETTER_AUTH_SECRET are configured in .env.local:
```bash
npm run seed:property
npm run seed:admin
```
</verification>

<success_criteria>
- Admin users page at /admin/users renders a table of all registered users
- UserTable shows name, email, role badge (admin=purple, user=blue), created date
- seed-admin.ts creates admin user via auth.api.createUser (not direct DB insert — uses Better Auth's hashing)
- seed-property.ts creates 5 units linked to the property, idempotent (safe to re-run)
- Both seed scripts accessible via npm run seed:admin and npm run seed:property
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-05-SUMMARY.md`
</output>
