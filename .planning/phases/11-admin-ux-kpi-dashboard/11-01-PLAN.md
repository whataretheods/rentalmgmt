---
phase: 11-admin-ux-kpi-dashboard
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(admin)/layout.tsx
  - src/components/admin/AdminSidebar.tsx
  - src/components/admin/MobileSidebar.tsx
autonomous: true
requirements: [AUX-04]

must_haves:
  truths:
    - "Admin sidebar is visible on desktop (>=1024px) showing all navigation links"
    - "Admin sidebar collapses to hamburger menu on mobile (<1024px)"
    - "Tapping hamburger opens a Sheet overlay with all navigation links"
    - "Navigating to a page via mobile sidebar closes the sidebar automatically"
    - "All interactive sidebar elements have minimum 44x44px touch targets"
  artifacts:
    - path: "src/components/admin/AdminSidebar.tsx"
      provides: "Shared sidebar navigation content used by desktop and mobile"
      min_lines: 40
    - path: "src/components/admin/MobileSidebar.tsx"
      provides: "Mobile hamburger trigger + Sheet overlay wrapping AdminSidebar"
      min_lines: 30
    - path: "src/app/(admin)/layout.tsx"
      provides: "Responsive admin layout with desktop sidebar and mobile hamburger"
      min_lines: 40
  key_links:
    - from: "src/app/(admin)/layout.tsx"
      to: "src/components/admin/AdminSidebar.tsx"
      via: "import and render in desktop sidebar region"
      pattern: "AdminSidebar"
    - from: "src/app/(admin)/layout.tsx"
      to: "src/components/admin/MobileSidebar.tsx"
      via: "import and render in mobile header"
      pattern: "MobileSidebar"
    - from: "src/components/admin/MobileSidebar.tsx"
      to: "src/components/admin/AdminSidebar.tsx"
      via: "renders AdminSidebar inside Sheet"
      pattern: "AdminSidebar"
---

<objective>
Build a mobile-responsive admin layout with a collapsible sidebar navigation.

Purpose: Replace the current horizontal nav bar with a persistent desktop sidebar and a hamburger-triggered Sheet overlay on mobile, making the admin interface fully usable on all device sizes.
Output: Responsive admin layout with sidebar navigation component.
</objective>

<execution_context>
@/Users/odesantos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/odesantos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@src/app/(admin)/layout.tsx
@src/components/ui/card.tsx

<interfaces>
<!-- Current admin layout structure to be replaced -->
From src/app/(admin)/layout.tsx:
```typescript
// Current: horizontal nav bar with inline Links
// Session check: auth.api.getSession({ headers: await headers() })
// Role check: session.user.role !== "admin"
// NotificationBell component imported from @/components/ui/NotificationBell
```

From src/components/ui/empty-state.tsx:
```typescript
export function EmptyState({ icon: Icon, title, description, action }: EmptyStateProps)
```

Admin routes to include in sidebar:
- /admin/dashboard (Dashboard)
- /admin/units (Units)
- /admin/payments (Payments)
- /admin/maintenance (Maintenance)
- /admin/documents (Documents)
- /admin/users (Users)
- /admin/invites (Invites)
- /admin/notifications (Notifications)
- /admin/broadcast (Broadcast)
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AdminSidebar and MobileSidebar components</name>
  <files>
    src/components/admin/AdminSidebar.tsx
    src/components/admin/MobileSidebar.tsx
  </files>
  <action>
First, install the shadcn Sheet component if not already installed:
```bash
npx shadcn@latest add sheet --yes
```

**AdminSidebar.tsx** — A shared navigation component used by both desktop and mobile:
- Create a "use client" component (needs usePathname for active link highlighting)
- Accept an optional `onNavigate?: () => void` prop (MobileSidebar passes this to close the Sheet on navigation)
- Import `usePathname` from `next/navigation` for active link detection
- Import Lucide icons for each nav item: LayoutDashboard, Building, CreditCard, Wrench, FileText, Users, Mail, Bell, Send
- Define nav items array: `{ label, href, icon }[]` with all 9 admin routes listed in context
- Render a `<nav>` with flex-col layout
- Each nav item is a Next.js `<Link>` with:
  - `min-h-[44px]` for touch-friendly targets (44px minimum per Apple HIG)
  - `flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium`
  - Active state: `bg-gray-100 text-gray-900` when `pathname === item.href` or `pathname.startsWith(item.href + '/')` (for nested routes like maintenance/[id])
  - Special case: Dashboard exact match only (`pathname === '/admin/dashboard'`)
  - Inactive state: `text-gray-600 hover:bg-gray-50 hover:text-gray-900`
  - Icon rendered at `h-5 w-5` size
  - On click, call `onNavigate?.()` to close mobile sidebar
- At the top, render "Admin Portal" text with a small building/home icon as the sidebar header
- At the bottom, render the user email (accept `userEmail?: string` prop) in small muted text

**MobileSidebar.tsx** — Hamburger button + Sheet overlay for mobile:
- Create a "use client" component
- Import Sheet, SheetContent, SheetTrigger from `@/components/ui/sheet`
- Import Menu (hamburger) icon from lucide-react
- Import AdminSidebar
- Manage `open` state with useState
- Use `usePathname()` to auto-close sidebar on route change: `useEffect(() => setOpen(false), [pathname])`
- Render:
  - `<Sheet open={open} onOpenChange={setOpen}>`
  - SheetTrigger: a button with Menu icon, `min-h-[44px] min-w-[44px]` for touch target, `lg:hidden` (only visible on mobile)
  - SheetContent with `side="left"` and `className="w-64 p-0"`:
    - Render `<AdminSidebar onNavigate={() => setOpen(false)} />` inside
  </action>
  <verify>
    <automated>
      cd /Users/odesantos/Documents/rentalmgmt && npx tsc --noEmit src/components/admin/AdminSidebar.tsx src/components/admin/MobileSidebar.tsx 2>&1 | head -20
    </automated>
  </verify>
  <done>AdminSidebar renders all 9 nav links with active state detection and 44px touch targets. MobileSidebar wraps AdminSidebar in a Sheet that auto-closes on navigation.</done>
</task>

<task type="auto">
  <name>Task 2: Refactor admin layout to use sidebar</name>
  <files>
    src/app/(admin)/layout.tsx
  </files>
  <action>
Replace the current horizontal nav bar layout with a responsive sidebar layout:

- Keep all existing imports: auth, headers, redirect, Link, NotificationBell
- Add imports: AdminSidebar, MobileSidebar
- Keep the EXACT same session validation and role check logic (do not modify auth flow)
- Replace the return JSX with:

```tsx
<div className="flex min-h-screen bg-gray-50">
  {/* Desktop sidebar — hidden on mobile */}
  <aside className="hidden lg:flex lg:w-64 lg:flex-col lg:fixed lg:inset-y-0 border-r bg-white">
    <AdminSidebar userEmail={session.user.email} />
  </aside>

  {/* Main content area — offset by sidebar width on desktop */}
  <div className="flex-1 lg:pl-64">
    {/* Mobile header with hamburger + NotificationBell */}
    <header className="sticky top-0 z-30 flex items-center justify-between border-b bg-white px-4 py-3 lg:hidden">
      <MobileSidebar />
      <span className="font-semibold text-gray-900">Admin Portal</span>
      <NotificationBell apiUrl="/api/admin/notifications" inboxUrl="/admin/notifications" />
    </header>

    {/* Desktop header — simplified, sidebar handles nav */}
    <header className="hidden lg:flex items-center justify-end border-b bg-white px-6 py-3">
      <div className="flex items-center gap-4">
        <NotificationBell apiUrl="/api/admin/notifications" inboxUrl="/admin/notifications" />
        <span className="text-sm text-gray-500">{session.user.email}</span>
      </div>
    </header>

    <main className="px-4 py-6 sm:px-6 lg:px-8">
      {children}
    </main>
  </div>
</div>
```

Key layout details:
- Desktop sidebar: `fixed inset-y-0` so it stays in place during scrolling, `w-64` width
- Main content: `lg:pl-64` to offset by sidebar width
- Mobile header: `sticky top-0 z-30` so it stays visible during scrolling
- Remove the old horizontal `<nav>` element entirely
- Mobile header shows hamburger (left), title (center), NotificationBell (right)
- Desktop header shows only NotificationBell and email (right-aligned) since sidebar handles navigation
- Main content uses responsive padding: `px-4 py-6 sm:px-6 lg:px-8`
  </action>
  <verify>
    <automated>
      cd /Users/odesantos/Documents/rentalmgmt && npx tsc --noEmit src/app/\(admin\)/layout.tsx 2>&1 | head -20
    </automated>
  </verify>
  <done>Admin layout uses fixed sidebar on desktop (>=1024px), hamburger menu on mobile. All existing auth checks preserved. NotificationBell visible on both mobile and desktop headers.</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. Desktop (>=1024px): sidebar visible with all 9 nav links, active link highlighted
3. Mobile (<1024px): sidebar hidden, hamburger visible in header, tapping hamburger opens Sheet with nav links
4. Navigation via mobile sidebar auto-closes the Sheet
5. All nav links have minimum 44px touch target height
6. Content area properly offset on desktop (no overlap with sidebar)
</verification>

<success_criteria>
- Admin layout renders a persistent sidebar on desktop screens
- Sidebar collapses to hamburger + Sheet overlay on mobile screens
- All navigation links present and functional with active state indication
- Touch targets are at least 44px for mobile usability
- No horizontal nav bar remains — fully replaced by sidebar
</success_criteria>

<output>
After completion, create `.planning/phases/11-admin-ux-kpi-dashboard/11-01-SUMMARY.md`
</output>
