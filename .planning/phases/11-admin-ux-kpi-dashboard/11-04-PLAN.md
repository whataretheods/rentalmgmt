---
phase: 11-admin-ux-kpi-dashboard
plan: 04
type: execute
wave: 3
depends_on: [11-01, 11-02, 11-03]
files_modified:
  - tests/admin-dashboard-kpi.spec.ts
  - tests/admin-empty-states.spec.ts
  - tests/admin-mobile-sidebar.spec.ts
autonomous: true
requirements: [AUX-02, AUX-03, AUX-04]

must_haves:
  truths:
    - "E2E tests verify KPI cards are rendered on the admin dashboard"
    - "E2E tests verify empty states appear on admin pages when no data exists"
    - "E2E tests verify mobile sidebar opens via hamburger and closes on navigation"
    - "All tests pass in headless mode"
  artifacts:
    - path: "tests/admin-dashboard-kpi.spec.ts"
      provides: "E2E tests for KPI dashboard (AUX-02)"
      min_lines: 30
    - path: "tests/admin-empty-states.spec.ts"
      provides: "E2E tests for empty states (AUX-03)"
      min_lines: 30
    - path: "tests/admin-mobile-sidebar.spec.ts"
      provides: "E2E tests for mobile responsive sidebar (AUX-04)"
      min_lines: 30
  key_links:
    - from: "tests/admin-dashboard-kpi.spec.ts"
      to: "src/app/(admin)/admin/dashboard/page.tsx"
      via: "navigates to /admin/dashboard and asserts KPI cards"
      pattern: "/admin/dashboard"
    - from: "tests/admin-mobile-sidebar.spec.ts"
      to: "src/app/(admin)/layout.tsx"
      via: "tests mobile viewport sidebar behavior"
      pattern: "setViewportSize"
---

<objective>
Create E2E test suites validating all Phase 11 requirements: KPI dashboard, empty states, and mobile responsive sidebar.

Purpose: Automated verification that all three requirements (AUX-02, AUX-03, AUX-04) are working correctly.
Output: Three Playwright test files covering all success criteria.
</objective>

<execution_context>
@/Users/odesantos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/odesantos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

<interfaces>
<!-- Playwright test patterns from project -->
Test directory: tests/
Config: playwright.config.ts
Admin login: seed an admin user via seed:admin script, then log in via /auth/login
Base URL: configured in playwright.config.ts (likely http://localhost:3000)
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create KPI dashboard and mobile sidebar E2E tests</name>
  <files>
    tests/admin-dashboard-kpi.spec.ts
    tests/admin-mobile-sidebar.spec.ts
  </files>
  <action>
First, read `playwright.config.ts` and any existing test files in `tests/` to understand the project's Playwright patterns (base URL, auth setup, test helpers).

**tests/admin-dashboard-kpi.spec.ts** — KPI dashboard tests:
- Import `test, expect` from `@playwright/test`
- Create a test group `test.describe('Admin KPI Dashboard', () => { ... })`
- Before each test, log in as admin:
  1. Navigate to `/auth/login`
  2. Fill in admin credentials (check seed scripts for admin email/password — likely from seed-admin.ts)
  3. Submit login form
  4. Wait for redirect to `/admin/dashboard`
- Test: "displays KPI metric cards":
  1. Navigate to `/admin/dashboard`
  2. Assert that at least 5 card elements are visible (use role or text matching)
  3. Assert text "Collection Rate" is visible
  4. Assert text "Total Outstanding" is visible
  5. Assert text "Occupancy Rate" is visible
  6. Assert text "Open Requests" is visible
  7. Assert text "Overdue Tenants" is visible
- Test: "KPI cards show formatted values":
  1. Navigate to `/admin/dashboard`
  2. Assert collection rate card contains a percentage (text matching `%`)
  3. Assert outstanding balance card contains a dollar sign `$`
  4. Assert occupancy rate card contains a percentage
- Test: "dashboard shows current month in subtitle":
  1. Navigate to `/admin/dashboard`
  2. Assert page contains the current month name (e.g., "February 2026")
- Test: "quick action links are present":
  1. Assert links to `/admin/users`, `/admin/units`, `/admin/payments` exist

**tests/admin-mobile-sidebar.spec.ts** — Mobile responsive sidebar tests:
- Import `test, expect` from `@playwright/test`
- Before each test, log in as admin (same pattern as above)
- Test: "sidebar visible on desktop viewport":
  1. Set viewport to `{ width: 1280, height: 720 }` (desktop)
  2. Navigate to `/admin/dashboard`
  3. Assert sidebar nav element is visible (look for the aside or nav with sidebar links)
  4. Assert "Dashboard" link is visible in the sidebar
  5. Assert hamburger menu button is NOT visible
- Test: "sidebar hidden on mobile, hamburger visible":
  1. Set viewport to `{ width: 375, height: 667 }` (iPhone SE)
  2. Navigate to `/admin/dashboard`
  3. Assert sidebar nav is NOT visible
  4. Assert hamburger menu button IS visible
- Test: "hamburger opens mobile sidebar sheet":
  1. Set viewport to `{ width: 375, height: 667 }`
  2. Navigate to `/admin/dashboard`
  3. Click hamburger button
  4. Wait for sidebar sheet to appear (Sheet renders with role="dialog" or look for nav links)
  5. Assert "Dashboard" link is visible in the sheet
  6. Assert "Payments" link is visible in the sheet
- Test: "mobile sidebar closes on navigation":
  1. Set viewport to `{ width: 375, height: 667 }`
  2. Navigate to `/admin/dashboard`
  3. Click hamburger to open sidebar
  4. Click "Payments" link in the sidebar
  5. Wait for URL to contain `/admin/payments`
  6. Assert sidebar sheet is no longer visible
- Test: "touch targets are at least 44px":
  1. Set viewport to `{ width: 375, height: 667 }`
  2. Navigate to `/admin/dashboard`
  3. Click hamburger to open sidebar
  4. For each nav link in the sidebar, evaluate its bounding box height
  5. Assert each link's height is >= 44 pixels

Use `page.setViewportSize()` for responsive testing. Tests should run headless.
  </action>
  <verify>
    <automated>
      cd /Users/odesantos/Documents/rentalmgmt && npx playwright test tests/admin-dashboard-kpi.spec.ts tests/admin-mobile-sidebar.spec.ts --reporter=list 2>&1 | tail -20
    </automated>
  </verify>
  <done>KPI dashboard tests verify all 5 metric cards render with formatted values. Mobile sidebar tests verify hamburger menu, sheet overlay, auto-close on navigation, and 44px touch targets.</done>
</task>

<task type="auto">
  <name>Task 2: Create empty states E2E tests</name>
  <files>
    tests/admin-empty-states.spec.ts
  </files>
  <action>
**tests/admin-empty-states.spec.ts** — Empty state tests:

These tests verify that admin pages show contextual empty states when no data exists. This requires either:
1. Testing against a clean database (no seed data), OR
2. Using specific text assertions that match the empty state messages

The cleanest approach: test the empty state text/elements exist in the page source. Since the E2E environment may have seed data, focus on structural tests:

- Import `test, expect` from `@playwright/test`
- Before each test, log in as admin

Approach: For each admin page, verify the EmptyState component exists and renders correctly when it's triggered. Since we can't guarantee empty data in E2E, use one of these strategies:
1. **Structural test**: Verify the EmptyState component is rendered correctly (check for specific CSS classes or role attributes)
2. **Conditional test**: Navigate to the page and check if either data OR empty state is present

Use the conditional approach — it validates the code path exists without requiring specific database state:

- Test: "users page has empty state or data":
  1. Navigate to `/admin/users`
  2. Assert EITHER: UserTable with rows is visible OR EmptyState with "No tenants yet" text is visible
  3. `expect(page.locator('text=No tenants yet').or(page.locator('table tbody tr'))).toBeVisible()`

- Test: "units page has empty state or data":
  1. Navigate to `/admin/units`
  2. Assert EITHER: table rows visible OR "No units configured" text visible

- Test: "payments page has empty state or data":
  1. Navigate to `/admin/payments`
  2. Assert EITHER: payment data visible OR "No payments recorded" text visible

- Test: "invites page has empty state or data":
  1. Navigate to `/admin/invites`
  2. Assert EITHER: invite manager visible OR "No units available for invites" text visible

- Test: "notifications page has empty state or data":
  1. Navigate to `/admin/notifications`
  2. Assert EITHER: notification cards visible OR "No notifications yet" text visible

- Test: "empty state component renders with correct structure":
  1. This test focuses on the EmptyState component rendering correctly
  2. Navigate to any page likely to show empty state (notifications is a good candidate)
  3. If empty state is shown, verify it has:
     - An icon element (SVG)
     - A title (h3 element with text)
     - A description (p element)
  4. If data exists, skip this assertion (test.skip with reason)

Use `page.locator().or()` pattern for conditional assertions. This handles both seeded and clean database states.
  </action>
  <verify>
    <automated>
      cd /Users/odesantos/Documents/rentalmgmt && npx playwright test tests/admin-empty-states.spec.ts --reporter=list 2>&1 | tail -20
    </automated>
  </verify>
  <done>Empty state tests verify all admin pages either show data or a contextual empty state. Tests are database-state agnostic using .or() pattern.</done>
</task>

</tasks>

<verification>
1. All test files compile and run without errors
2. `npx playwright test tests/admin-dashboard-kpi.spec.ts` passes
3. `npx playwright test tests/admin-mobile-sidebar.spec.ts` passes
4. `npx playwright test tests/admin-empty-states.spec.ts` passes
5. All tests run headless (no browser windows opened)
</verification>

<success_criteria>
- Three test files created covering AUX-02, AUX-03, AUX-04
- KPI tests verify all 5 metric cards with proper formatting
- Mobile tests verify sidebar visibility, hamburger menu, and touch targets
- Empty state tests verify contextual guidance on all admin pages
- All tests pass in headless mode
</success_criteria>

<output>
After completion, create `.planning/phases/11-admin-ux-kpi-dashboard/11-04-SUMMARY.md`
</output>
